<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>TETRIS</title>
<script type="text/javascript">
var block2D =[ 
	[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],
	[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],
	[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],
	[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],
	[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0]
];
var stack2D =[ 
	[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],
	[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],
	[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],
	[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],
	[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0]
];
var print2D =[ 
	[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],
	[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],
	[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],
	[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],
	[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0]
];

var block = {
	kind : 5,
	status : 0,
	i : 2,
	j : 4
}

function setBlock2DByBlock(){
	for(var i=0;i<print2D.length;i++){
		for(var j=0;j<print2D[i].length;j++){
			print2D[i][j]=0;
			block2D[i][j]=0;
		}
	}
	
	if(block.kind == 5){
		if(block.status == 0){
			block2D[block.i		][block.j	]=block.kind;
			block2D[block.i-1	][block.j	]=block.kind;
			block2D[block.i		][block.j-1	]=block.kind;
			block2D[block.i		][block.j+1	]=block.kind;
		}
		if(block.status == 1){
			block2D[block.i		][block.j	]=block.kind;
			block2D[block.i-1	][block.j	]=block.kind;
			block2D[block.i+1	][block.j	]=block.kind;
			block2D[block.i		][block.j+1	]=block.kind;

		}		
		if(block.status == 2){
			block2D[block.i		][block.j	]=block.kind;
			block2D[block.i		][block.j-1	]=block.kind;
			block2D[block.i		][block.j+1	]=block.kind;
			block2D[block.i+1	][block.j	]=block.kind;
		}	
		if(block.status == 3){
			block2D[block.i		][block.j	]=block.kind;
			block2D[block.i-1	][block.j	]=block.kind;
			block2D[block.i		][block.j-1	]=block.kind;
			block2D[block.i+1	][block.j	]=block.kind;
		}		
		
		
	}
}

function init(){
	window.addEventListener('keydown', function(e){
		mykeytype(e);
	});	
	
	stack2D[22][0]=11;
	stack2D[22][1]=11;
	stack2D[22][2]=11;
	stack2D[22][3]=11;
	stack2D[22][4]=11;
	stack2D[22][5]=11;
}

function mykeytype(e){
	var flagDown = false;
	pre_i		= block.i;
	pre_j		= block.j;
	pre_status	= block.status;
	
	
	//아래 40 좌 37 우 39 위 38
	if(e.keyCode == 40){
		block.i++;
		flagDown = true;
	}
	if(e.keyCode == 39){
		block.j++;
	}	
	if(e.keyCode == 38){
		changeStatus();
	}	
	if(e.keyCode == 37){
		block.j--;
	}	
	

	try{
		setBlock2DByBlock();
	} catch (e) {

	}
	
	var flagOut = isOut();
	var flagCrash = isCrash();

	console.log("flagCrash:"+flagCrash)
	if(flagOut || flagCrash){
		block.i			=pre_i;
		block.j			=pre_j;
		block.status	=pre_status;
		setBlock2DByBlock();
		if(flagDown){
			moveBlock2Stack();
			remove10();
			
			block.status = 0;
			block.i = 2;
			block.j = 4;
			setBlock2DByBlock();
		}
	}
	
	setPrint2DByBlockStack();
	myrender();
	console.log(block2D)
	console.log(stack2D)
	console.log(print2D)
}

function remove10(){
	
	
}

function moveBlock2Stack(){
	for(var i=0;i<print2D.length;i++){
		for(var j=0;j<print2D[i].length;j++){
			if(block2D[i][j]>0 ){
				stack2D[i][j] = block2D[i][j]+10;
			}
		}
	}
}

function isCrash(){
	for(var i=0;i<print2D.length;i++){
		for(var j=0;j<print2D[i].length;j++){
			if(block2D[i][j]>0 && stack2D[i][j]>0){
				return true;
			}
		}
	}
	return false;
}
function isOut(){
	var cnt = 0;
	for(var i=0;i<print2D.length;i++){
		for(var j=0;j<print2D[i].length;j++){
			if(block2D[i][j]>0){
				cnt++;
			}
		}
	}
	if(cnt == 4){
		return false;
	} else {
		return true;
	}
	
}

function changeStatus(){
	if(block.kind == 1){
		
	}
	
	if(block.kind == 2 || block.kind == 3 || block.kind == 4){
		if(block.status == 0){
			block.status = 1;
		}else if(block.status == 1){
			block.status = 0;
		}	
	}	
	
	if(block.kind == 5 || block.kind == 6 || block.kind == 7){
		if(block.status == 0){
			block.status = 1;
		}else if(block.status == 1){
			block.status = 2;
		}else if(block.status == 2){
			block.status = 3;
		}else if(block.status == 3){
			block.status = 0;
		}
		
	}		
}

function myrender(){
	var arrTd = document.getElementsByTagName("td");
	for(var i=0;i<print2D.length;i++){
		for(var j=0;j<print2D[i].length;j++){
			var idx = i*10 + j;
			if(print2D[i][j] == 0) arrTd[idx].style.background = '#ffffff';
			
			if(print2D[i][j] == 1) arrTd[idx].style.background = '#ff0000';
			if(print2D[i][j] == 2) arrTd[idx].style.background = '#ef0000';
			if(print2D[i][j] == 3) arrTd[idx].style.background = '#df0000';
			if(print2D[i][j] == 4) arrTd[idx].style.background = '#cf0000';
			if(print2D[i][j] == 5) arrTd[idx].style.background = '#bf0000';
			if(print2D[i][j] == 6) arrTd[idx].style.background = '#af0000';
			if(print2D[i][j] == 7) arrTd[idx].style.background = '#9f0000';
			
			if(print2D[i][j] == 11) arrTd[idx].style.background = '#0000ff';
			if(print2D[i][j] == 12) arrTd[idx].style.background = '#0000ef';
			if(print2D[i][j] == 13) arrTd[idx].style.background = '#0000df';
			if(print2D[i][j] == 14) arrTd[idx].style.background = '#0000cf';
			if(print2D[i][j] == 15) arrTd[idx].style.background = '#0000bf';
			if(print2D[i][j] == 16) arrTd[idx].style.background = '#0000af';
			if(print2D[i][j] == 17) arrTd[idx].style.background = '#00009f';

		}	
	}
}

function setPrint2DByBlockStack(){
	for(var i=0;i<print2D.length;i++){
		for(var j=0;j<print2D[i].length;j++){
			if(stack2D[i][j] > 0){
				print2D[i][j] = stack2D[i][j];
			}
			if(block2D[i][j] > 0){
				print2D[i][j] = block2D[i][j];
			}
		}
	}
}





</script>
<style type="text/css">
td{
 	width: 20px;
 	height: 10px;
}
</style>
</head>
<body onload="init()">
<table border="1px">
	<tr>
		<td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td>
		<td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td>
	</tr>
	<tr>
		<td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td>
		<td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td>
	</tr>	
	<tr>
		<td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td>
		<td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td>
	</tr>
	<tr>
		<td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td>
		<td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td>
	</tr>
	<tr>
		<td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td>
		<td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td>
	</tr>
	<tr>
		<td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td>
		<td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td>
	</tr>	
	<tr>
		<td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td>
		<td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td>
	</tr>
	<tr>
		<td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td>
		<td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td>
	</tr>
	<tr>
		<td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td>
		<td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td>
	</tr>
	<tr>
		<td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td>
		<td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td>
	</tr>	
	<tr>
		<td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td>
		<td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td>
	</tr>
	<tr>
		<td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td>
		<td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td>
	</tr>
	<tr>
		<td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td>
		<td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td>
	</tr>
	<tr>
		<td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td>
		<td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td>
	</tr>	
	<tr>
		<td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td>
		<td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td>
	</tr>
	<tr>
		<td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td>
		<td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td>
	</tr>
	<tr>
		<td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td>
		<td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td>
	</tr>
	<tr>
		<td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td>
		<td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td>
	</tr>	
	<tr>
		<td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td>
		<td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td>
	</tr>
	<tr>
		<td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td>
		<td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td>
	</tr>
	<tr>
		<td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td>
		<td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td>
	</tr>
	<tr>
		<td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td>
		<td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td>
	</tr>	
	<tr>
		<td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td>
		<td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td>
	</tr>


</table>



</body>
</html>
















